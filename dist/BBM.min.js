/*!
 * BareBonesMarkup v2.0.0
 * Copyright 2013-2014 Preole Soandso
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.BBM=e():t.BBM=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";t.exports=n(1)},function(t,e,n){"use strict";function r(t){return t.type!==M.WS&&t.type!==M.NL}function i(t){return t.type===M.NL}function u(t){return t.type===M.NL||t.type===M.REF_END}function s(t){return t.type===M.NL||t.type===M.ATX_END}function o(t,e){return e.isLineStart()&&(e.isLineEnd()||p(t)||r(t)&&t.col<e.minCol)}function a(t){return t.type===M.ATX_END||t.type===M.HR}function p(t){return a(t)||t.type===M.DIV}function c(t,e){return!(t.type!==M.CODE&&t.type!==M.PRE||e.type!==M.CODE&&e.type!==M.PRE||t.lexeme!==e.lexeme)}function f(t){return t.type===M.BRACKET_R}function l(t){return t.type===M.GT}function h(t){return t.type===M.LINK_CONT||r(t)}function L(t,e){return e&&t.type===M.BRACKET_R||!!H[t.type]}function T(t){var e=t.peekUntil(r)||k,n=null,i=b[e.type]?y:B[e.type];return t.lvl+=1,i&&t.lvl<=t.maxDepth?n=i(t,e):e!==k&&(n=v(t,e)),t.lvl-=1,n}function y(t,e){return t.next(),t.isLineEnd()?K(b[e.type]):(t.nextUntil(r),e.type===M.DT?v(t,t.peek()||k,S._DT):d(t,e))}function d(t,e){for(var n=K(b[e.type]),i=e.col+e.lexeme.length,u=null;(u=t.peekUntil(r))&&u.col>=i;)n.append(T(t));return n}function E(t,e){return t.nextPast(i),K(e.type===M.HR?S.HR:S._TR)}function I(t,e){var n=K(S.DIV),u=e.col,s=null;for(t.nextPast(i);(s=t.peekUntil(r))&&s.col>=u&&(!t.isDelim(s,e)||!t.nextPast(i));)n.append(T(t));return n}function _(t,e){var n=C.rmNLTail(t.nextPast(i).textPast(t.isDelim,e,e.col));return e.type===M.PRE?K(S.PRE).append(n):K(S.COMMENT).append(n)}function x(t,e){var n=t.next().peekT(M.WS)?t.next().pos:t.pos,r=t.nextUntil(s).pos,i=K(S.HEADER);return i.level=e.lexeme.length,t.mark=t.peekT(M.WS,-1)?r-1:r,t.pos=n,m(t,i),t.mark=-1,t.pos=r+1,i}function N(t,e){var n=C.rmCTRL(t.next().textPast(i)).trim(),r=e.type===M.ID;return n?K(r?S._ID:S._CLASS).attr(r?"id":"class",n):void 0}function D(t){var e=t.next().textPast(u).trim(),n=t.peekT(M.NL,-1)?"":t.textUntil(i).trim();n&&e&&(t.root.symTable[e]=n)}function v(t,e,n){t.minCol=e.col||0;var r=t.pos,u=t.nextUntil(o,t).pos,s=t.peek()||k,p=K(S.P);return t.mark=t.next(s===k?-1:-2).nextUntil(i).pos,t.pos=r,m(t,p),n?p.type(n):a(s)&&(p.type(S.HEADER),p.level=s.type===M.HR?2:1),t.mark=-1,t.pos=r>=u||a(s)?u+1:u,p}function m(t,e){for(var n=t.stack.indexOf(M.BRACKET_R)>-1;t.pos<t.mark;){var r=t.textUntil(L,n),i=t.next().peek(-1)||k;if(e.append(r),i.type===M.CODE||i.type===M.PRE)e.append(U(t,i));else if(i.type===M.LINK_IMG)e.append(O(t,i));else if(A[i.type])e.append(n?i.lexeme:R(t,i));else{if(-1!==t.stack.indexOf(i.type)||!P[i.type])break;t.stack.push(i.type),e.append(m(t,K(H[i.type]))),t.stack.pop()}}return e}function R(t,e){var n=e.type===M.LINK_INT?f:l,r=C.rmCTRL(t.textPast(n)).trim();if(r){var i=K(H[e.type]).attr({href:r}),u=t.pos;return t.nextUntil(h).peekT(M.LINK_CONT)?(t.stack.push(M.BRACKET_R),m(t.next(),i),t.stack.pop()):t.pos=u,i}}function O(t){var e=C.rmCTRL(t.textPast(l)).trim();if(e){var n="",r=t.pos;return t.nextUntil(h).peekT(M.LINK_CONT)?n=t.next().textPast(f).trim():t.pos=r,K(S.LINK_IMG).attr({src:e,alt:n})}}function U(t,e){return K(S.CODE).append(t.textPast(c,e))}var K=t.exports=n(2),C=n(3),g=n(4),M=g.ENUM,S=K.ENUM,k={},P={DEL:1,BOLD:1,EM:1,SUP:1,SUB:1,UNDER:1},A={LINK_INT:1,LINK_WIKI:1,LINK_EXT:1},B={HR:E,TRSEP:E,REF:D,ATX:x,COMMENT:_,PRE:_,DIV:I,CLASS:N,ID:N},b={TH:S._TH,TD:S._TD,GT:S.BLOCKQUOTE,DT:S._DT,DD:S._DD,OL:S._LI_OL,UL:S._LI_UL},H={LINK_INT:S.LINK_INT,LINK_EXT:S.LINK_EXT,LINK_IMG:S.LINK_IMG,LINK_WIKI:S.LINK_WIKI,DEL:S.DEL,BOLD:S.BOLD,EM:S.EM,SUP:S.SUP,SUB:S.SUB,UNDER:S.U,CODE:S.CODE,PRE:S.CODE};K.parse=function(t,e){var n=g.isLexer(t)?t:g(t);for(n.maxDepth=Math.abs(parseInt(e,10)||8),n.root=K(S.ROOT),n.root.symTable={},n.stack=[],n.lvl=0;n.peek();)n.root.append(T(n));return n.root.prune()},K.fn.parse=function(t,e){return this.empty().append(K.parse(t,e).children())}},function(t,e,n){"use strict";var r=t.exports=n(5)&&n(6)&&n(7)&&n(8)&&n(9)&&n(10)&&n(11);r.fn.prune=function(){return this.pruneList().pruneBlank().pruneURL().pruneID().pruneText()}},function(t){"use strict";var e=t.exports={},n=Array.prototype,r=Object.prototype;e.toString=function(t){return r.toString.call(t)},e.isArray=Array.isArray||function(t){return"[object Array]"===e.toString(t)},e.isString=function(t){return"string"==typeof t},e.isNumber=function(t){return"number"==typeof t},e.isFunction=function(t){return"function"==typeof t},e.isObject=function(t){return e.isFunction(t)||"object"==typeof t&&null!==t},e.isBlankString=function(t){return/^\s*$/.test(t)},e.flatten=function(t,r){for(t=n.concat.apply([],t);!r&&t.some(e.isArray);)t=n.concat.apply([],t);return t},e.map=function(t,e,n){return t.map(function(t){return e(t,n)})},e.repeatString=function(t,e){for(var n="";e>0;)n+=e%2===1?t:"",t+=e>1?t:"",e=Math.floor(e/2);return n},e.rmNL=function(t){return t.replace(/[\v\f\r\n\u0085\u2028\u2029]+/g,"")},e.rmNLTail=function(t){return t.replace(/[\v\f\r\n\u0085\u2028\u2029]+$/,"")},e.rmCTRL=function(t){return t.replace(/[\u0000-\u001f\u007f-\u009f\u2028\u2029]+/g,"")},e.escapeHTML=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e.escapeATTR=function(t){return e.escapeURI(e.rmCTRL(e.escapeHTML(t).replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/`/g,"&#x60;")))},e.escapeURI=function(t){return t.replace(/^javascript:/i,"javascript;").replace(/^data:/i,"data;")},e.has=function(t,e){return r.hasOwnProperty.call(t,e)},e.get=function(t,n){return e.has(t,n)?t[n]:void 0},e.extend=function(t){var r=e.isObject(t)?t:{};return n.forEach.call(arguments,function(t){if(t!==r&&e.isObject(t))for(var n in t)e.has(t,n)&&(r[n]=t[n])}),r}},function(t){"use strict";var e=t.exports=function(){var t=function(){var t="[ \\t\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000]",e="[\\v\\f\\nÂ…\u2028\u2029]|\\r\\n?",n="(?="+e+"|$)",r=function(t,e){return{name:t,pattern:e}};return[r("ESCAPE","\\\\[\\S]"),r("TH","!!"+t),r("TD","\\|\\|"+t),r("TRSEP","\\|[=]+"+n),r("ATX_END","=+"+n),r("ATX","=+"),r("HR","-{4,}"+n),r("COMMENT","/{4,}"+n),r("CLASS","\\.\\."+t),r("ID","\\."+t),r("GT",">"),r("REF",":{"),r("REF_END","}:"),r("DD",":"+t),r("DT",";"+t),r("DIV","\\*{4,}"+n),r("OL","[0-9#]+\\."+t),r("UL","[\\-\\+\\*\\u2022\\u2043]"+t),r("PRE","`{3,}"+n),r("CODE","`+"),r("DEL","--"),r("BOLD","\\*{2}"),r("SUP","\\^{2}"),r("SUB",",,"),r("UNDER","__"),r("EM","''"),r("LINK_EXT","\\?<"),r("LINK_IMG","!<"),r("LINK_WIKI","#<"),r("LINK_INT","#\\["),r("LINK_CONT","-\\["),r("BRACKET_R","\\]"),r("NL",e),r("WS",t+"+")]}(),e=function(){var e=t.map(function(t){return"("+t.pattern+")"});return new RegExp(e.join("|"),"g")}(),n=function(){var e={TEXT:"TEXT"};return t.forEach(function(t){e[t.name]=t.name}),e}(),r=function(t,e,n){return{lexeme:t||"",type:e||"",col:n||0}},i=function(i){for(var u=new RegExp(e),s=[],o=0;o<i.length;){var a=u.exec(i),p=t[a?a.indexOf(a[0],1)-1:-1],c=a?a.index:i.length;c>o&&s.push(r(i.slice(o,c),n.TEXT)),p&&s.push(r(a[0],p.name)),o=a?u.lastIndex+=o>u.lastIndex?1:0:c}return s.forEach(function(t){t.type===n.ESCAPE&&t.lexeme.length>1&&(t.lexeme=t.lexeme.slice(1))}),s.forEach(function(t,e,r){var i=r[e-1];t.col=0===e||i.type===n.NL?0:i.col+i.lexeme.length}),s},u=function(t){var e=Object.create(u.prototype);return e._tokens=i(t),e.minCol=0,e.mark=-1,e.pos=0,e};return u.ENUM=n,u}();e.isLexer=function(t){return e.prototype.isPrototypeOf(t)},e.fn=function(t){var n=e.ENUM;return t.peek=function(t){return this._tokens[this.pos+(t||0)]},t.peekT=function(t,e){return this.peek(e)?this.peek(e).type===t:void 0},t.peekUntil=function(t,e){return this._tokens[this.nextUntil(t,e).pos]},t.isLineStart=function(t){var e=t||0,r=this.peek(e-1),i=this.peek(e-2);return!r||r.type===n.NL||r.type===n.WS&&(!i||i.type===n.NL)},t.isLineEnd=function(t){var e=t||0,r=this.peek(e),i=this.peek(e+1);return!r||r.type===n.NL||r.type===n.WS&&(!i||i.type===n.NL)},t.isDelim=function(t,e){var n=t||this.peek();return n&&e.type===n.type&&e.lexeme===n.lexeme&&e.col===n.col&&this.isLineStart()},t.size=function(){return this._tokens.length},t.next=function(t){return this.pos+=t||1,this},t.nextUntil=function(t,e){for(;this.peek()&&this.pos!==this.mark&&!t.call(this,this.peek(),e);)this.next();return this},t.nextPast=function(t,e){return this.nextUntil(t,e),this.pos===this.mark?this:this.next()},t.textUntil=function(t,e,r){var i=this,u=r||i.minCol||0,s="";return this.nextUntil(function(r){return t.call(i,r,e)?!0:void(s+=u>0&&r.type===n.WS&&i.isLineStart()?r.lexeme.slice(u):r.lexeme)}),s},t.textPast=function(t,e,n){var r=this.textUntil(t,e,n);return this.pos!==this.mark&&this.next(),r},t}(e.prototype)},function(t,e,n){"use strict";var r=n(3),i=t.exports=function(t){var e=Object.create(i.prototype);return e._type=String(t).toLocaleUpperCase(),e._attr={},e._nodes=[],e._parent=null,e},u=i.ENUM=function(){var t={},e=["_DT","_DD","_TH","_TD","_TR","_LI_UL","_LI_OL","_ID","_CLASS","_DUMMY","ROOT","COMMENT","P","BLOCKQUOTE","PRE","DIV","LI","UL","OL","HEADER","DT","DD","DL","TH","TD","HR","TR","TABLE","LINK_INT","LINK_EXT","LINK_IMG","LINK_WIKI","DEL","U","SUB","SUP","EM","BOLD","CODE","TEXT"];return e.forEach(function(e){t[e]=e}),t}();i.isNode=function(t){return i.prototype.isPrototypeOf(t)},i.fn=function(t){function e(t,e){return r.isString(t)&&t.length>0||r.isNumber(t)?i(u.TEXT).text(String(t)):(i.isNode(t)&&(t.replaceWith(),t._parent=e),t)}function n(t,n){return r.isArray(t)?r.map(r.flatten(t),e,n).filter(i.isNode):e(t,n)}function s(t){return i.isNode(t)&&(t._parent=null),t}function o(t){var e=t.children(),n=e.length>0?e.splice(0,e.length):e;return n.forEach(s),n}function a(t,e,n,r){return n.call(t,e,r),e.children().forEach(function(e){a(t,e,n,r)}),t}function p(t,e,n,r){return e.children().forEach(function(e){p(t,e,n,r)}),n.call(t,e,r),t}return t.splice=function(t,e,u){var o=n(u,this),a=this.children(),p=r.isArray(o)?[t,e].concat(o):o,c=r.isArray(p)?a.splice.apply(a,p):i.isNode(p)?a.splice(t,e,p):a.splice(t,e);return c.forEach(s),this},t.parent=function(){return this._parent},t.children=function(t){return t?this._nodes.slice():this._nodes},t.size=function(){return this.children().length},t.first=function(){return this.children()[0]},t.last=function(){return this.children()[this.children().length-1]},t.isFirstChild=function(){return this.parent()&&this.parent().first()===this},t.isLastChild=function(){return this.parent()&&this.parent().last()===this},t.pop=function(){return s(this.children().pop())},t.shift=function(){return s(this.children().shift())},t.append=function(t){var e=n(t,this),u=this.children();return i.isNode(e)?u.push(e):r.isArray(e)&&u.push.apply(u,e),this},t.prepend=function(t){var e=n(t,this),u=this.children();return i.isNode(e)?u.unshift(e):r.isArray(e)&&u.unshift.apply(u,e),this},t.replaceWith=function(t){var e=this.parent()?this.parent().children().indexOf(this):-1;return e>-1&&this.parent().splice(e,1,t),this},t.replace=function(t){return i.isNode(t)&&t.replaceWith(this),this},t.empty=function(){return o(this),this},t.filterChild=function(t){var e=this;return o(e).forEach(function(n,r,i){e.append(t.call(e,n,r,i)?n:null)}),e},t.rebuildChild=function(t){var e=this;return o(e).forEach(function(n,r,i){t(e,n,r,i)}),e},t.eachPre=function(t,e){return a(this,this,t,e)},t.find=function(t,e){var n=[];return this.eachPre(function(r){t.call(this,r,e)&&n.push(this)}),n},t.eachPost=function(t,e){return p(this,this,t,e)},t.text=function(t){return 0===arguments.length?this._value||"":((r.isString(t)&&t.length>0||r.isNumber(t))&&(this._value=t),this)},t.attr=function(t,e){if(r.isObject(t))r.extend(this._attr,t);else{if(0===arguments.length)return this._attr;if(1===arguments.length)return r.get(this._attr,t);arguments.length>1&&(this._attr[t]=String(e))}return this},t.removeAttr=function(t){return arguments.length>=1?delete this._attr[t]:this._attr={},this},t.type=function(t){return 0===arguments.length?this._type:(this._type=String(t).toLocaleUpperCase(),this)},t.toJSON=function(){var t=r.extend({},this);return delete t._parent,t},t}(i.prototype)},function(t,e,n){"use strict";function r(t){return l.has(y,t.type())||l.has(T,t.type())}function i(t,e){var n=e.attr("class")||" ";return t.attr("id")&&e.attr("id",t.attr("id")),t.attr("class")&&e.attr("class",(t.attr("class")+" "+n).trim()),e}function u(t,e){var n=e.type()===h._TR,r=e.type()===h._TD?h.TD:h.TH,i=t.type()===h.TABLE?t:f(h.TABLE).append(f(h.TR));return n?i.last().size()>0&&i.append(e.type(h.TR)):i.last().append(e.type(r)),i}function s(t,e){var n=t.type()===h.UL?t:f(h.UL);return n.append(e.type(h.LI))}function o(t,e){var n=t.type()===h.OL?t:f(h.OL);return n.append(e.type(h.LI))}function a(t,e){var n=t.type()===h.DL?t:f(h.DL),r=e.type();return n.append(e.type(r===h._DD?h.DD:h.DT))}function p(t,e){var n=t.last()||L,r=e.type(),u=n.type(),s=e;l.has(y,r)&&(s=y[r](n,s)),l.has(T,u)&&(s=i(n,s)),s!==n&&t.append(s)}function c(t){t.children().some(r)&&t.rebuildChild(p)}var f=t.exports=n(5),l=n(3),h=f.ENUM,L=f("_DUMMY"),T={_ID:1,_CLASS:1},y={_DT:a,_DD:a,_TH:u,_TD:u,_TR:u,_LI_UL:s,_LI_OL:o};f.fn.pruneList=function(){return this.eachPost(c)}},function(t,e,n){"use strict";function r(t){return t.type()===f.PRE||t.type()===f.COMMENT}function i(t){return c.isBlankString(t.text())&&0===t.size()&&!h[t.type()]}function u(t){return t.text()||!i(t)}function s(t){var e=t.first()?t.first().size():0;t.children().forEach(function(t){if(t.size()>0){for(;t.size()>e;)t.pop();for(;t.size()<e;)t.append(p(f.TD))}})}function o(t){for(var e=null;(e=t.first())&&e.type()===f.DD;)t.shift();for(;(e=t.last())&&e.type()===f.DT;)t.pop()}function a(t){var e=t.type();return!r(t)&&t.children().every(i)?t.empty().append(l[e]?t.attr("href"):null):(e===f.TABLE?s(t):e===f.DL&&o(t),void t.filterChild(u))}var p=t.exports=n(5),c=n(3),f=p.ENUM,l={LINK_EXT:1,LINK_INT:1,LINK_WIKI:1},h={PRE:1,TD:1,TH:1,LI:1,BLOCKQUOTE:1,DD:1,DT:1,HR:1,DIV:1,LINK_EXT:1,LINK_INT:1,LINK_WIKI:1,LINK_IMG:1,COMMENT:1};p.fn.pruneBlank=function(){return this.eachPost(a)}},function(t,e,n){"use strict";function r(t,e){var n=t.type(),r=t.attr();n===s.LINK_IMG?r.src=u.get(e,r.src)||r.src:u.has(o,n)&&(r.href=u.get(e,r.href)||r.href)}var i=t.exports=n(5),u=n(3),s=i.ENUM,o={LINK_EXT:1,LINK_INT:1,LINK_WIKI:1};i.fn.pruneURL=function(){return u.isObject(this.symTable)?this.eachPre(r,this.symTable):this}},function(t,e,n){"use strict";function r(t,e){var n=u.rmCTRL(t.attr("id")||"");n&&!u.has(e,n)?t.attr("id",e[n]=n):t.removeAttr("id")}var i=t.exports=n(5),u=n(3);i.fn.pruneID=function(){return this.eachPre(r,{})}},function(t,e,n){"use strict";function r(t,e,n){return(n[e-1]||o).text()&&t.text()}function i(t,e){var n=t.last()||o;n.text()&&e.text()?n.text(n.text()+e.text()):t.append(e)}function u(t){t.children().some(r)&&t.rebuildChild(i)}var s=t.exports=n(5),o=s("_DUMMY");s.fn.pruneText=function(){return this.eachPre(u)}},function(t,e,n){"use strict";function r(t){return t.type()!==y.LINK_IMG&&t.type()!==y.HR}function i(t,e){return e.xhtml&&!r(t)?" /":""}function u(t,e){return d[t.type()]?"":T.repeatString(" ",e.depth)}function s(t){return d[t.type()]?"":"\n"}function o(t,e){var n="",r=t.attr(),i=t.type();for(var u in r)T.has(r,u)&&!T.isBlankString(u)&&(n+=T.escapeATTR(u).substr(0,e.maxAttrChars)+'="'+(i===y.LINK_INT&&"href"===u?"#":"")+T.escapeATTR(r[u]).substr(0,e.maxAttrChars)+'" ');return 0===n.length?"":" "+n.trim()}function a(t,e){var n=E[t.type()]||"";return n&&t.level>0&&(n+=Math.min(Math.floor(t.level)+e.headerOffset,6)),n}function p(t,e){var n=a(t,e);return n?u(t,e)+"<"+n+o(t,e)+i(t,e)+">"+s(t,e):""}function c(t,e){var n=a(t,e);return n&&r(t,e)?s(t,e)+u(t,e)+"</"+n+">"+(t.isLastChild()?"":s(t,e)):""}function f(t,e){return e.comment?u(t,e)+"<!--\n"+T.map(t.children(),h,e).join("")+u(t,e)+"-->"+(t.isLastChild()?"":s(t,e)):""}function l(t,e){var n=e.rmNL&&-1===e.stack.indexOf(y.PRE);return T.escapeHTML(n?T.rmNL(t.text()):t.text())}function h(t,e){var n="";return e.depth+=1,e.stack.push(t.type()),n=t.text()?l(t,e):t.type()===y.COMMENT?f(t,e):p(t,e)+T.map(t.children(),h,e).join("")+c(t,e),e.stack.pop(),e.depth-=1,n}var L=t.exports=n(5),T=n(3),y=L.ENUM,d={U:1,EM:1,DEL:1,INS:1,SUB:1,SUP:1,BOLD:1,CODE:1,LINK_IMG:1,LINK_INT:1,LINK_WIKI:1,LINK_EXT:1},E={P:"p",BLOCKQUOTE:"blockquote",PRE:"pre",DIV:"div",LI:"li",UL:"ul",OL:"ol",HEADER:"h",DT:"dt",DD:"dd",DL:"dl",TH:"th",TD:"td",HR:"hr",TR:"tr",TABLE:"table",LINK_INT:"a",LINK_EXT:"a",LINK_IMG:"img",LINK_WIKI:"a",DEL:"del",U:"u",SUB:"sub",SUP:"sup",EM:"em",BOLD:"strong",CODE:"code"};L.fn.toHTML=function(t){var e=T.extend({},t);return e.depth=a(this)?-1:-2,e.stack=[],e.maxAttrChars=Math.abs(parseInt(e.maxAttrChars,10)||2048),e.headerOffset=Math.abs(parseInt(e.headerOffset,10)||0),h(this,e)}}])});