/*!
 * @desc BakaBakaMark: An Extensible LML-HTML Compiler
 * @version 1.0.0
 * @license BSD-2-Clause; Copyright (c) 2014 Preole, All rights reserved.
*/
var BBMCompiler=function(){"use strict";function a(a,c){for(var d=[],e=0,f=a.length;f>e;e+=1)d.push(b(a[e],c));return d.join(eb)}function b(a,b){return G.CSS_PRE+(b?j(a):a)}function c(a){return O.lastIndex=0,a.replace(O,"")}function d(a){return T.lastIndex=0,a.replace(T,"")}function e(a){return Q.lastIndex=0,a.replace(Q,"")}function f(a){return g(h(a))}function g(a){return a.replace(S,"")}function h(a){return a.replace(R,"")}function i(a){return n(f(d(a)))}function j(a){return c(d(a))}function k(a){return V.lastIndex=0,W.lastIndex=0,X.lastIndex=0,Y.lastIndex=0,Z.lastIndex=0,_.lastIndex=0,a.replace(V,"&amp;").replace(X,"&lt;").replace(W,"&gt;").replace(Z,"&quot;").replace(Y,"&#x27;").replace(_,"&#x2F;")}function l(a){return V.lastIndex=0,W.lastIndex=0,X.lastIndex=0,a.replace(V,"&amp;").replace(X,"&lt;").replace(W,"&gt;")}function m(a){return $.lastIndex=0,k(f(d(a))).replace($,"&#x60;")}function n(a){return a.replace(ab,"javascript;").replace(bb,"data;")}function o(a,b){var c="";if(0>=b)return c;for(;1&b&&(c+=a),b>>=1,b;)a+=a;return c}function p(a,b,c){var d=(a.length>>>0)-1,e=c?c:d;if(0>e)return-1;for(e>a.length-1&&(e=d),e;e>=0&&a[e]!==b;e-=1);return e}function q(a,b,c){for(var d=[],e=0,f=a.length>>>0;f>e;e+=1){var g=a[e];b.call(c,g,e,a)&&d.push(g)}return d}function r(a,b){if(null==a||null==b)return a;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function s(a,b,c){this.col=c,this.lexeme=b,this.type=a}function t(a,b){this.children=[],this.type=a,this.err=!1,this.meta=b||{},this.parent=null,this.isDeleted=!1}function u(a){function b(b){return a.charAt(V+(b||0))}function c(b){var c=a.substring(V+1,b.length+V+1);return c===b}function d(a){return N.test(b(a))}function e(a){return P.test(b(a))||""===b(a)}function f(a){return e(a)||d(a)}function g(b){b=Math.abs(b||1),V+=b,U+=b,W=a.charAt(V)}function h(b){b=Math.abs(b||1),T+=b,V+=b,W=a.charAt(V)}function i(){return""!==W}function j(b){var c=a.substring(T,V),d=R[R.length-1];d&&d.isType(fb.TEXT)&&b===fb.TEXT?(X=d,d.lexeme+=c):(X=new s(b,c,S),R.push(X))}function k(){d(1)&&(g(2),j(fb.UL_ITEM))}function l(){if(c("-}"))g(3),j(fb.DEL_END);else if(c("---")){for(;"-"===W;)g();e()&&j(fb.DIV_LINE)}else"["===b(1)?(g(2),j(fb.LINK_CONT)):d(1)&&(g(2),j(fb.UL_ITEM))}function m(){for(;"="===W;)g();j(e()?fb.ATX_END:fb.ATX)}function n(){d(1)?(g(2),j(fb.UL_ITEM)):c("+}")&&(g(3),j(fb.INS_END))}function o(){if(d(1))g(2),j(fb.UL_ITEM);else if("*"!==b(1)||c("***")){if(c("***")){for(;"*"===W;)g();e()&&j(fb.ASIDE_DELIM)}}else g(2),j(fb.BOLD)}function p(){"!"===b(1)?(g(2),j(fb.TH)):"<"===b(1)&&F.ALLOW_IMG&&(g(2),j(fb.LINK_IMG))}function q(){if("|"===b(1))g(2),j(fb.TD);else if("="===b(1)){for(g();"="===W;)g();e()&&j(fb.TR_DELIM)}}function r(){if(c('""')){for(;'"'===W;)g();j(fb.CODE)}}function t(){"."===b(1)&&d(2)?(g(3),j(fb.OL_ITEM)):"<"===b(1)&&F.ALLOW_LINK?(g(2),j(fb.LINK_WIKI)):"["===b(1)&&F.ALLOW_LINK&&(g(2),j(fb.LINK_INT))}function u(){for(;cb.test(W);)g();"."===b()&&d(1)&&(g(2),j(fb.OL_ITEM))}function v(){"^"===b(1)&&(g(2),j(fb.SUP))}function w(){","===b(1)&&(g(2),j(fb.SUB))}function x(){"_"===b(1)&&(g(2),j(fb.UNDER))}function y(){"<"===b(1)&&F.ALLOW_LINK&&(g(2),j(fb.LINK_EXT))}function z(){g(),j(fb.BRACKET_L)}function A(){g(),j(fb.BRACKET_R)}function B(){c("--")?(g(3),j(fb.DEL)):c("++")&&(g(3),j(fb.INS))}function C(){":"===b(1)&&(g(2),j(fb.LINK_REF_END))}function D(){g(),j(fb.GT_THAN)}function E(){e(1)?(g(),j(fb.LABEL_STOP)):F.ALLOW_ID&&d(1)?(g(2),j(fb.LABEL_ID)):F.ALLOW_CLASS&&"."===b(1)&&d(2)&&(g(3),j(fb.LABEL_CLASS))}function G(){"'"===b(1)&&(g(2),j(fb.ITAL))}function H(){if(c("///")){for(;"/"===W;)g();e()&&j(fb.COMMENT_DELIM)}}function I(){d(1)&&(g(2),j(fb.DT_MARK))}function J(){d(1)?(g(2),j(fb.DD_MARK)):"{"===b(1)&&(g(2),j(fb.LINK_REF))}function K(){for(;!Z[W]&&!f()&&i();)g();j(fb.TEXT)}function L(){for(;N.test(W);)g();j(fb.SPACES)}function M(){"\r"===W&&"\n"===b(1)?(g(2),Y["\r\n"]=(Y[W]||0)+1):(g(1),Y[W]=(Y[W]||0)+1),j(fb.NL),U=1}function O(){h(),f()?d()?L():M():(g(),K(fb.TEXT))}for(var Q=null,R=[],S=1,T=0,U=1,V=0,W=a.charAt(V),X=null,Y={"\r\n":0,"\n":0,"\r":0},Z={"[":z,"]":A,"{":B,"}":C,":":J,";":I,"-":l,"=":m,"|":q,"!":p,"#":t,"+":n,"*":o,"^":v,",":w,_:x,"'":G,">":D,"?":y,".":E,"/":H,'"':r,"\\":O,"•":k,"⁃":k};i();)Z[W]?Z[W]():N.test(W)?L():P.test(W)?M():cb.test(W)?u():K(),V===T&&g(),X===Q&&K(),W=a.charAt(V),X=Q,S=U,T=V;j(fb.EOF);var $=0;for(var _ in Y)Y[_]>$&&($=Y[_],db=_);return"\r\n"!==db&&"\r"!==db&&"\n"!==db&&(db="\n"),R}function v(a){function b(){return a[Q+1]&&(Q+=1,R=a[Q]),Q}function c(b){return a[b]&&(Q=b,R=a[Q]),Q}function d(b,c){var d=c?c+Q:Q;return a[d]?a[d].isType(b):!1}function e(a){var b=a||0;return d(fb.NL,b)||d(fb.EOF,b)}function g(){return R instanceof s&&!d(fb.EOF)}function h(a){var b=d(fb.SPACES);return b&&l()&&(R.lexeme=R.substring(a-1,R.getLength())),b}function k(a){if(!g()||m())return!0;if(R.col<a&&!d(fb.SPACES)&&!e())return!0;var b=lb[R.type],c=l()&&o();return b&&c}function l(){return e(-1)||d(fb.SPACES,-1)&&e(-2)}function m(){var a=0;return e(a)?e(a+1)?!0:d(fb.SPACES,a+1)&&e(a+2):!1}function n(a){return l()&&R.col===a?d(fb.DIV_LINE)||d(fb.ATX_END):!1}function o(){return e(1)||d(fb.SPACES,1)&&e(2)}function q(a,b){var c=b?b:R;return a?(pb[c.type]?a.push(0):qb[c.type]&&a.pop(),a.length<=0):!1}function r(a){return d(fb.GT_THAN)&&mb[a.type]}function u(a){return l()&&R.col===a.col&&o()?R.isSameType(a)&&R.lexeme===a.lexeme:!1}function v(a){return R!==a&&R.isSameType(a)?d(fb.CODE)&&R.lexeme==a.lexeme:!1}function w(){var a=0;return d(fb.SPACES,a)&&(a+=1),d(fb.NL,a)&&(a+=1),d(fb.SPACES,a)&&(a+=1),d(fb.LINK_CONT,a)}function x(b,c){for(var d="",e=b;c>e&&a[e]instanceof s;e+=1)d+=a[e].lexeme;return d}function y(a,c){for(var d=Q;g()&&!a[R.type];)b();return c?x(d,Q):void 0}function z(a,c){for(var d=Q;!e();)b();return c&&b(),a?x(d,Q):void 0}function A(){for(;d(fb.SPACES)||d(fb.NL);)b()}function B(){var a=R,b=new t(gb.ASIDE);for(z(!1,!0),A();g()&&R.col>=a.col;){if(u(a)){z();break}b.addNode(D()),A()}return b}function C(){var a=R.lexeme.length,d=Q;b();var e=f(y(nb,!0));if(z(),0===e.length)return c(d),R.type=fb.TEXT,null;var g=new t(gb.HEADER);return g.addText(e),g.meta.HEADERLVL=a,g}function D(){var a=null,b=S<F.MAX_BLOCKS;if(A(),hb[R.type]&&b)S+=1,a=I(),S-=1;else{if(d(fb.LABEL_ID)||d(fb.LABEL_CLASS))return H();if(d(fb.CODE)&&d(fb.NL,1))a=E();else if(d(fb.ASIDE_DELIM)&&b)S+=1,a=B(),S-=1;else if(d(fb.ATX))a=C();else if(d(fb.LINK_REF))a=J();else{if(d(fb.COMMENT_DELIM))return G(),a;d(fb.TR_DELIM)?(z(),a=new t(gb.TR)):d(fb.LABEL_STOP)?(z(),a=new t(gb.STOP)):d(fb.DIV_LINE)?(z(),a=new t(gb.DIV_LINE)):d(fb.ATX_END)&&(R.type=fb.TEXT)}}return!a&&g()&&(A(),a=K()),a}function E(){var a=new t(gb.CODE_BLOCK),c=R;z(!1,!0);for(var e=Q,f=Q;g()&&(h(c.col),!u(c));)f=b();return d(fb.SPACES,-1)&&(f-=1),a.addText(x(e,f)),e>=f&&a.addText(db),z(),a}function G(){for(var a=R;g();)if(z(),A(),u(a)){z();break}}function H(){var a=R.isType(fb.LABEL_ID);b();var c=j(z(!0,!1));return 0===c.length||a&&T[c]?null:(a&&(T[c]=c),new t(a?gb.ID:gb.CLASS,{ID:c}))}function I(){var a=new t(hb[R.type]);if(b(),d(fb.SPACES)&&b(),e())return a;if(a.isType(gb.DT))return a.addNodes(K()),a;for(var c=R.col;g()&&R.col>=c;)a.addNode(D()),A();return a}function J(){var a=Q,e="",f="";return b(),e=i(y(ob,!0)),d(fb.LINK_REF_END)?(b(),f=i(z(!0)),0===e.length||0===f.length?(c(a),K()):new t(gb.LINK_REF,{REF_ID:e,URL:f})):(c(a),K())}function K(a,c,e,f){for(var g=c?c:[],i=a||R.col,j=new t(gb.PARA),l=Q,m=Q,o=R,r=!1,s=null;!k(i)&&(h(i),r||!q(e,o));){if(jb[o.type]){var u=p(g,o.type);if(u>=0){u===g.length-1&&(j.type=jb[o.type]);break}var v=kb[o.type],y=g.length>=F.MAX_SPANS;v&&!y&&(b(),g.push(v),s=K(i,g,e,f),g.pop(),s.err=s.isType(gb.PARA))}else if(ib[o.type])s=N(i,f);else if(o.isType(fb.CODE))s=M(i);else if(r&&o.isType(fb.LINK_CONT)){var z=L(i,j.getLast());z===j.getLast()?l=Q+1:s=z,r=!1}s instanceof t?(s.err?m+=1:k(i)||(b(),r=rb[s.type]&&w()),j.addText(x(l,m)),j.addNode(s),l=Q):b(),m=Q,o=R,s=null}return!c&&n(i)&&(j.type=gb.HEADER,j.meta.HEADERLVL=d(fb.ATX_END)?1:2,b()),j.addText(x(l,m)),j}function L(a,c){if(!(c instanceof t&&rb[c.type]))return null;var d=null;if(c.isType(gb.LINK_IMG)){if(d=O(a),d.err)return d;c.meta.ALT=d.meta.TEXT}else{var e=[0];if(b(),d=K(a,[],e,!0),0!==e.length)return d.err=!0,d;c.addNodes(d)}return c}function M(a){var b=O(a);if(b.err)return b;var c=new t(gb.CODE);return c.addNode(b),c}function N(a,b){var c=R,d=c.isType(fb.LINK_IMG);if(b&&!d)return null;var e=O(a);return e.err||(e.type=ib[c.type],e.meta.URL=i(e.meta.TEXT),e.err=0===e.meta.URL.length,e.err?(e.type=gb.TEXT,delete e.meta.URL):(delete e.meta.TEXT,d&&(e.meta.ALT=""))),e}function O(a){var c=new t(gb.TEXT),d=R,e=Q+1,f=pb[d.type]?[0]:null;for(c.err=!0,b();!k(a);){if(h(a),q(f)||v(d)||r(d)){c.err=!1;break}b()}return c.meta.TEXT=x(e,Q),c}for(var P=new t(gb.ROOT),Q=0,R=a[Q],S=0,T={};g();)P.addNode(D());return P}function w(a){function b(a){for(var b=a.getLast();b&&b.isType(gb.TR)&&0===b.getLength();)a.pop(),b=a.getLast();for(var c=a.getFirst().getLength(),d=0,e=a.getLength();e>d;d+=1){for(var f=a.children[d];f.getLength()>c;)f.pop();for(;f.getLength()<c&&f.getLength()>0;)f.addNode_simple(new t(gb.TD));f.isDeleted=f.getLength()<=0}}function c(a){for(var b=a.getLast();b&&b.isType(gb.DT);)a.pop(),b=a.getLast();for(var c=a.getFirst();c&&c.isType(gb.DD);)a.popFirst(),c=a.getFirst();a.isDeleted=0===a.getLength()}function d(a){var b=0,c=0,f=null;for(b=0,c=a.getLength();c>b&&(f=a.children[b],!f.isType(gb.TEXT)||U.test(f.meta.TEXT))&&(!(f.getLength()>0||rb[f.type])||(d(f),f.isDeleted));b+=1);if(a.isDeleted=b>=c&&!rb[a.type],!a.isDeleted&&(rb[a.type]&&1===a.getLength()&&(f=a.getLast(),f.isType(gb.TEXT)&&U.test(f.meta.TEXT)&&a.pop()),F.RM_EOL))for(b=0,c=a.getLength();c>b;b+=1)f=a.children[b],f.isType(fb.TEXT)&&(f.meta.TEXT=e(f.meta.TEXT))}function f(a){for(var e=0,i=a.getLength();i>e;e+=1){var j=a.children[e];if(j.isType(gb.TABLE)&&b(j),j.isType(gb.DL)&&c(j),j.isType(gb.TEXT)||sb[j.type]||rb[j.type]){if(d(a),!a.isDeleted){var k=a.getLast();k.isType(gb.TEXT)&&(k.meta.TEXT=g(k.meta.TEXT))}return}j.getLength()>0&&!j.isType(gb.CODE_BLOCK)&&f(j),j.isDeleted=tb[j.type]&&j.getLength()<=0}h(a)}function h(a){var b=a.getLength()-1;for(b;b>=0;b-=1){var c=a.children[b];{if(!c.isDeleted&&!ub[c.type])break;a.pop()}}a.isDeleted=0>b&&!rb[a.type]}function i(a){return a.isDeleted?!1:(a.children=q(a.children,i),(tb[a.type]||sb[a.type])&&(a.isDeleted=a.getLength()<=0),!a.isDeleted)}return f(a),a.children=q(a.children,i),a}function x(a){return w(v(u(a)))}function y(c){function d(a,b){if(!vb[a.type])return"";var c=vb[a.type],d="<"+c;if(a.isType(gb.HEADER)&&a.meta.HEADERLVL){var e=a.meta.HEADERLVL+G.MIN_HEADER;d+=e>6?"6":e+""}if(b)for(var f in b)b[f]=b[f].substring(0,G.MAX_ATTR_CHARS),d+=" "+f+'="'+m(b[f])+'"';return wb[a.type]&&G.XHTML&&(d+="/"),d+=">",a.isType(gb.CODE_BLOCK)&&(d+="<code>"),d}function e(a){if(!vb[a.type])return"";var b=vb[a.type];if(a.isType(gb.HEADER)&&a.meta.HEADERLVL){var c=a.meta.HEADERLVL+G.MIN_HEADER;b+=c>6?"6":c+""}return a.isType(gb.CODE_BLOCK)?"</code></"+b+">":"</"+b+">"}function f(a){return a instanceof t&&a.meta.TEXT?G.XHTML?k(a.meta.TEXT):l(a.meta.TEXT):""}function g(a){for(var c=a.meta.URL,f=a.isType(gb.LINK_IMG),g=a.meta.ALT,i=a.parent,k=!1;i;){if(rb[i.type]&&(k=!0),i.meta.SYM_TABLE&&i.meta.SYM_TABLE[c]){c=i.meta.SYM_TABLE[c];break}i=i.parent}a.isType(gb.LINK_INT)&&(c="#"+b(c)),f&&U.test(g)&&k&&(g=c);var m=f?{src:c,alt:g}:{href:c};return f?d(a,m):(a.isType(gb.LINK_WIKI)&&(m["class"]=j(G.CSS_WIKI)),a.getLength()>0?d(a,m)+h(a,m)+e(a):d(a,m)+l(a.meta.URL)+e(a))}function h(a){var b=a.getLength(),c=0,i="";for(c=0;b>c;c+=1){var j=a.children[c];i+=rb[j.type]?g(j):sb[j.type]?d(j)+h(j)+e(j):f(j)}return i}function i(a,b,c){return o(eb,c)+d(a,b)+db}function n(c,f,g,j){var k=c.getLength(),l=0,m=null,p="",q=null,r=null,s=null,t="",u=d(c,f),v=e(c,f),w=o(eb,g);for(l=0;k>l;l+=1)if(m=c.children[l],m.isType(gb.ID))s=b(m.meta.ID,!0);else if(m.isType(gb.CLASS))q=q?q:[],q.push(m.meta.ID);else{if((s||q)&&(r={},s&&(r.id=s),q&&(r["class"]=a(q,!0))),s=null,q=null,m.isType(gb.DIV_LINE))p+=i(m,f,g);else{if(m.isType(gb.TEXT)||sb[m.type]||rb[m.type]){p+=h(c);break}p+=n(m,r,g+1,l===k-1)}r=null}if(c.isType(gb.CODE_BLOCK))t=u+p+v;else{if(c.isType(gb.ROOT))return p;t=w+u+db+p+db+w+v}return j||(t+=db),t}return n(c,null,-1,!1)}function z(c){function d(a,b){var c=vb[a.type]||"";if(a.isType(gb.HEADER)&&a.meta.HEADERLVL){var d=a.meta.HEADERLVL+G.MIN_HEADER;c="h",c+=d>6?"6":d+""}if(c.length<=0)return k.createDocumentFragment();var e=k.createElement(c);if(b)for(var f in b)b[f]=b[f].substring(0,G.MAX_ATTR_CHARS),e.setAttribute(f,b[f]);return e}function e(a){var b=k.createElement("pre"),c=k.createElement("code");return c.appendChild(f(a.children[0])),b.appendChild(c),b}function f(a){return k.createTextNode(a.meta.TEXT)}function g(a){for(var c=a.meta.URL,e=a.isType(gb.LINK_IMG),f=a.meta.ALT,g=a.parent,i=!1;g;){if(rb[g.type]&&(i=!0),g.meta.SYM_TABLE&&g.meta.SYM_TABLE[c]){c=g.meta.SYM_TABLE[c];break}g=g.parent}a.isType(gb.LINK_INT)&&(c="#"+b(c)),e&&U.test(f)&&i&&(f=c);var l=e?{src:c,alt:f}:{href:c};if(a.isType(gb.LINK_WIKI)&&(l["class"]=j(G.CSS_WIKI)),a.getLength()>0)return h(a,l);var m=d(a,l);return e||m.appendChild(k.createTextNode(a.meta.URL)),m}function h(c,i){var j=c.getLength(),k=0,l=null,m=null,n=null,o=null,p=d(c,i);for(k=0;j>k;k+=1)l=c.children[k],l.isType(gb.ID)?n=b(l.meta.ID,!0):l.isType(gb.CLASS)?(m=m?m:[],m.push(l.meta.ID)):((n||m)&&(o={},n&&(o.id=n),m&&(o["class"]=a(m,!1))),n=null,m=null,p.appendChild(l.isType(gb.CODE_BLOCK)?e(l):l.isType(gb.TEXT)?f(l):rb[l.type]?g(l):h(l,o)),o=null);return p}var i="undefined"==typeof window?null:window,k="undefined"==typeof document?null:document;return i&&k?h(c):null}function A(a,b){F=r(D,a),G=r(E,b)}function B(a){return y(x(a))}function C(a){return z(x(a))}var D={RM_EOL:0,MAX_BLOCKS:8,MAX_SPANS:10,ALLOW_IMG:1,ALLOW_LINK:1,ALLOW_CLASS:1,ALLOW_ID:1},E={MAX_ATTR_CHARS:2048,CSS_PRE:"bbm-",CSS_WIKI:"w-bbm",MIN_HEADER:0,XHTML:0},F=D,G=E,H="[ \\u2000-\\u200d\\t\\u202f\\u205f\\u3000\\u1680\\u180e\\u00a0\\u00b7\\u237d\\u2420\\u2422\\u2423]+",I="[\\v\\f\\r\\n\\u0085\\u2028\\u2029]+",J="[ \\u2000-\\u200d\\t\\u202f\\u205f\\u3000\\u1680\\u180e\\u00a0\\u00b7\\u237d\\u2420\\u2422\\u2423\\v\\f\\r\\n\\u0085\\u2028\\u2029]+",K="[\\u0000-\\u001f\\u007f-\\u009f\\u2028\\u2029]+",L="^"+J,M=J+"$",N=new RegExp(H),O=new RegExp(H,"g"),P=new RegExp(I),Q=new RegExp(I,"g"),R=new RegExp(L),S=new RegExp(M),T=new RegExp(K,"g"),U=new RegExp("^$|^"+J+"$"),V=/&/g,W=/>/g,X=/</g,Y=/'/g,Z=/"/g,$=/`/g,_=/\//g,ab=/^javascript:/i,bb=/^data:/i,cb=/[0-9]+/,db="\n",eb=" ",fb={SPACES:"SPACES",NL:"NL",TEXT:"TEXT",UNDER:"UNDER",SUB:"SUB",SUP:"SUP",CODE:"CODE",ITAL:"ITAL",BOLD:"BOLD",INS:"INS",INS_END:"INS_END",DEL:"DEL",DEL_END:"DEL_END",DIV_LINE:"DIV_LINE",COMMENT_DELIM:"COMMENT_DELIM",ASIDE_DELIM:"ASIDE_DELIM",TH:"TH",TD:"TD",TR_DELIM:"TR_DELIM",ATX:"ATX",ATX_END:"ATX_END",OL_ITEM:"OL_ITEM",UL_ITEM:"UL_ITEM",DT_MARK:"DT_MARK",DD_MARK:"DD_MARK",LABEL_CLASS:"LABEL_CLASS",LABEL_ID:"LABEL_ID",LABEL_STOP:"LABEL_STOP",LINK_REF_END:"LINK_REF_END",LINK_REF:"LINK_REF",LINK_CONT:"LINK_CONT",LINK_INT:"LINK_INT",LINK_WIKI:"LINK_WIKI",LINK_EXT:"LINK_EXT",LINK_IMG:"LINK_IMG",GT_THAN:"GT_THAN",BRACKET_L:"BRACKET_L",BRACKET_R:"BRACKET_R",EOF:"EOF"},gb={ROOT:"ROOT",PARA:"PARA",STOP:"STOP",BLOCKQUOTE:"BLOCKQUOTE",CODE_BLOCK:"CODE_BLOCK",ASIDE:"ASIDE",ID:"ID",CLASS:"CLASS",UL:"UL",OL:"OL",UL_LI:"UL_LI",OL_LI:"OL_LI",HEADER:"HEADER",DIV_LINE:"DIV_LINE",DT:"DT",DD:"DD",DL:"DL",TH:"TH",TD:"TD",TR:"TR",TABLE:"TABLE",LINK_REF:"LINK_REF",LINK_INT:"LINK_INT",LINK_EXT:"LINK_EXT",LINK_IMG:"LINK_IMG",LINK_WIKI:"LINK_WIKI",TEXT:"TEXT",DEL:"DEL",INS:"INS",UNDER:"UNDER",SUB:"SUB",SUP:"SUP",ITAL:"ITAL",BOLD:"BOLD",CODE:"CODE"},hb={GT_THAN:gb.BLOCKQUOTE,UL_ITEM:gb.UL_LI,OL_ITEM:gb.OL_LI,DT_MARK:gb.DT,DD_MARK:gb.DD,TH:gb.TH,TD:gb.TD},ib={LINK_INT:gb.LINK_INT,LINK_EXT:gb.LINK_EXT,LINK_IMG:gb.LINK_IMG,LINK_WIKI:gb.LINK_WIKI},jb={INS:gb.INS,DEL:gb.DEL,INS_END:gb.INS,DEL_END:gb.DEL,BOLD:gb.BOLD,ITAL:gb.ITAL,SUP:gb.SUP,SUB:gb.SUB,UNDER:gb.UNDER},kb={INS:fb.INS_END,DEL:fb.DEL_END,BOLD:fb.BOLD,ITAL:fb.ITAL,SUP:fb.SUP,SUB:fb.SUB,UNDER:fb.UNDER},lb={ASIDE_DELIM:1,ATX_END:1,DIV_LINE:1},mb={LINK_EXT:1,LINK_IMG:1,LINK_WIKI:1},nb={ATX_END:1,NL:1},ob={LINK_REF_END:1,NL:1},pb={BRACKET_L:1,LINK_INT:1,LINK_CONT:1},qb={BRACKET_R:1},rb={LINK_IMG:1,LINK_EXT:1,LINK_INT:1,LINK_WIKI:1},sb={SUB:1,SUP:1,ITAL:1,BOLD:1,DEL:1,INS:1,UNDER:1,CODE:1},tb={STOP:1,PARA:1,BLOCKQUOTE:1,ASIDE:1,UL_LI:1,OL_LI:1,HEADER:1,OL:1,UL:1,DL:1,DD:1,DT:1,TR:1},ub={ID:1,CLASS:1,STOP:1},vb={PARA:"p",BLOCKQUOTE:"blockquote",CODE_BLOCK:"pre",ASIDE:"div",UL_LI:"li",OL_LI:"li",OL:"ol",UL:"ul",DL:"dl",DD:"dd",DT:"dt",DIV_LINE:"hr",TH:"th",TD:"td",TR:"tr",TABLE:"table",LINK_INT:"a",LINK_EXT:"a",LINK_WIKI:"a",LINK_IMG:"img",SUB:"sub",SUP:"sup",ITAL:"em",BOLD:"strong",DEL:"del",INS:"ins",UNDER:"u",CODE:"code",HEADER:"h"},wb={LINK_IMG:1,DIV_LINE:1};return s.prototype={isType:function(a){return this.type===a},isSameType:function(a){return this.type===a.type},substring:function(a,b){return this.lexeme.substring(a,b)},getLength:function(){return this.lexeme.length}},t.prototype={getLast:function(){return this.children[this.children.length-1]},getFirst:function(){return this.children[0]},getLength:function(){return this.children.length},isType:function(a){return this.type===a},isSameType:function(a){return this.type===a.type},pop:function(){this.children.pop()},popFirst:function(){this.children.shift()},addNode_simple:function(a){var b=this.getLast();return b&&b.isType(gb.TEXT)&&b.isSameType(a)?void(b.meta.TEXT+=a.meta.TEXT):(a.parent=this,void this.children.push(a))},addNode_table:function(a){var b=this.getLast();if(!b||!b.isType(gb.TABLE)){if(a.isType(gb.TR))return;b=new t(gb.TABLE),this.addNode_simple(b)}b.getLength()<=0&&b.addNode_simple(new t(gb.TR));var c=b.getLast();a.isType(gb.TH)||a.isType(gb.TD)?c.addNode_simple(a):a.isType(gb.TR)&&c.getLength()>0&&b.addNode_simple(a)},addNode_ul_ol:function(a){var b=a.isType(gb.UL_LI)?gb.UL:gb.OL,c=this.getLast();c&&c.isType(b)||(c=new t(b),this.addNode_simple(c)),c.addNode_simple(a)},addNode_dl:function(a){var b=this.getLast();b&&b.isType(gb.DL)||(b=new t(gb.DL),this.addNode_simple(b)),b.addNode_simple(a)},addNode:function(a){a instanceof t&&a!==this&&(a.isType(gb.LINK_REF)?(this.meta.SYM_TABLE||(this.meta.SYM_TABLE={}),this.meta.SYM_TABLE[a.meta.REF_ID]=a.meta.URL):this.isType(gb.PARA)&&this.isSameType(a)?this.addNodes(a):a.isType(gb.UL_LI)||a.isType(gb.OL_LI)?this.addNode_ul_ol(a):a.isType(gb.TR)||a.isType(gb.TH)||a.isType(gb.TD)?this.addNode_table(a):a.isType(gb.DD)||a.isType(gb.DT)?this.addNode_dl(a):this.addNode_simple(a))},addText:function(a){a&&a.length>0&&this.addNode_simple(new t(gb.TEXT,{TEXT:a}))},addNodes:function(a){if(a instanceof t&&a!==this)for(var b=0,c=a.children.length;c>b;b+=1)this.addNode_simple(a.children[b])}},{lexer:u,parser:v,filter:w,frontEnd:x,compileStr:B,compileDOM:C,setOptions:A,AST_ENUM:gb,LEX_ENUM:fb,ASTNode:function(a,b){return new t(a,b)},LexToken:function(a,b,c){return new s(a,b,c)}}}();"undefined"!=typeof module&&(module.exports=BBMCompiler);