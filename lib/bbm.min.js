/*!
 * @desc BakaBakaMark: An Extensible LML-HTML Compiler
 * @version 1.0.0
 * @license BSD-2-Clause; Copyright (c) 2014 Preole, All rights reserved.
*/
var BBMCompiler=function(){"use strict";function a(a){for(var b=[],c=0,d=a.length;d>c;c+=1)b.push(D.CSS_PRE+i(a[c]));return b.join(P)}function b(a,b){return D.CSS_PRE_ID+(b?i(a):a)}function c(a){return I.lastIndex=0,a.replace(I,"")}function d(a){return L.lastIndex=0,a.replace(L,"")}function e(a){return K.lastIndex=0,a.replace(K,"")}function f(a){return a.replace(/(^\s+)|(\s+$)/g,"")}function g(a){return a.replace(/\s+$/g,"")}function h(a){return m(f(d(a)))}function i(a){return c(d(a))}function j(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}function k(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(a){return j(f(d(a))).replace(/`/g,"&#x60;")}function m(a){return a.replace(/^javascript:/i,"javascript;").replace(/^data:/i,"data;")}function n(a,b){var c="";if(0>=b)return c;for(;1&b&&(c+=a),b>>=1,b;)a+=a;return c}function o(a,b,c){var d=(a.length>>>0)-1,e=c?c:d;if(0>e)return-1;for(e>a.length-1&&(e=d),e;e>=0&&a[e]!==b;e-=1);return e}function p(a,b,c){for(var d=[],e=0,f=a.length>>>0;f>e;e+=1){var g=a[e];b.call(c,g,e,a)&&d.push(g)}return d}function q(a,b){if(null==a||null==b)return a;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function r(a,b,c){this.col=c,this.lexeme=b,this.type=a}function s(a,b){this.children=[],this.type=a,this.err=!1,this.meta=b||{},this.parent=null,this.isDeleted=!1}function t(a){function b(b){return a.charAt(Y+(b||0))}function c(b){var c=a.substring(Y+1,b.length+Y+1);return c===b}function d(a){return H.test(b(a))}function e(a){return J.test(b(a))||""===b(a)}function f(a){return e(a)||d(a)}function g(b){b=Math.abs(b||1),Y+=b,X+=b,Z=a.charAt(Y)}function h(b){b=Math.abs(b||1),W+=b,Y+=b,Z=a.charAt(Y)}function i(){return""!==Z}function j(b){var c=a.substring(W,Y),d=U[U.length-1];d&&d.isType(Q.TEXT)&&b===Q.TEXT?($=d,d.lexeme+=c):($=new r(b,c,V),U.push($))}function k(){d(1)&&(g(2),j(Q.UL_ITEM))}function l(){if(c("-}"))g(3),j(Q.DEL_END);else if(c("---")){for(;"-"===Z;)g();e()&&j(Q.DIV_LINE)}else"["===b(1)?(g(2),j(Q.LINK_CONT)):d(1)&&(g(2),j(Q.UL_ITEM))}function m(){for(;"="===Z;)g();j(e()?Q.ATX_END:Q.ATX)}function n(){d(1)?(g(2),j(Q.UL_ITEM)):c("+}")&&(g(3),j(Q.INS_END))}function o(){if(d(1))g(2),j(Q.UL_ITEM);else if("*"!==b(1)||c("***")){if(c("***")){for(;"*"===Z;)g();e()&&j(Q.ASIDE_DELIM)}}else g(2),j(Q.BOLD)}function p(){"!"===b(1)?(g(2),j(Q.TH)):"<"===b(1)&&C.ALLOW_IMG&&(g(2),j(Q.LINK_IMG))}function q(){if("|"===b(1))g(2),j(Q.TD);else if("="===b(1)){for(g();"="===Z;)g();e()&&j(Q.TR_DELIM)}}function s(){if(c('""')){for(;'"'===Z;)g();j(Q.CODE)}}function t(){"."===b(1)&&d(2)?(g(3),j(Q.OL_ITEM)):"<"===b(1)&&C.ALLOW_LINK?(g(2),j(Q.LINK_WIKI)):"["===b(1)&&C.ALLOW_LINK&&(g(2),j(Q.LINK_INT))}function u(){for(;N.test(Z);)g();"."===b()&&d(1)&&(g(2),j(Q.OL_ITEM))}function v(){"^"===b(1)&&(g(2),j(Q.SUP))}function w(){","===b(1)&&(g(2),j(Q.SUB))}function x(){"_"===b(1)&&(g(2),j(Q.UNDER))}function y(){"<"===b(1)&&C.ALLOW_LINK&&(g(2),j(Q.LINK_EXT))}function z(){g(),j(Q.BRACKET_L)}function A(){g(),j(Q.BRACKET_R)}function B(){c("--")?(g(3),j(Q.DEL)):c("++")&&(g(3),j(Q.INS))}function D(){":"===b(1)&&(g(2),j(Q.LINK_REF_END))}function E(){g(),j(Q.GT_THAN)}function F(){e(1)?(g(),j(Q.LABEL_STOP)):C.ALLOW_ID&&d(1)?(g(2),j(Q.LABEL_ID)):C.ALLOW_CLASS&&"."===b(1)&&d(2)&&(g(3),j(Q.LABEL_CLASS))}function G(){"'"===b(1)&&(g(2),j(Q.ITAL))}function I(){if(c("///")){for(;"/"===Z;)g();e()&&j(Q.COMMENT_DELIM)}}function K(){d(1)&&(g(2),j(Q.DT_MARK))}function L(){d(1)?(g(2),j(Q.DD_MARK)):"{"===b(1)&&(g(2),j(Q.LINK_REF))}function M(){for(;!ab[Z]&&!f()&&i();)g();j(Q.TEXT)}function P(){for(;H.test(Z);)g();j(Q.SPACES)}function R(){"\r"===Z&&"\n"===b(1)?(g(2),_["\r\n"]=(_[Z]||0)+1):(g(1),_[Z]=(_[Z]||0)+1),j(Q.NL),X=1}function S(){h(),f()?d()?P():R():(g(),M(Q.TEXT))}for(var T=null,U=[],V=1,W=0,X=1,Y=0,Z=a.charAt(Y),$=null,_={"\r\n":0,"\n":0,"\r":0},ab={"[":z,"]":A,"{":B,"}":D,":":L,";":K,"-":l,"=":m,"|":q,"!":p,"#":t,"+":n,"*":o,"^":v,",":w,_:x,"'":G,">":E,"?":y,".":F,"/":I,'"':s,"\\":S,"•":k,"⁃":k};i();)ab[Z]?ab[Z]():H.test(Z)?P():J.test(Z)?R():N.test(Z)?u():M(),Y===W&&g(),$===T&&M(),Z=a.charAt(Y),$=T,V=X,W=Y;j(Q.EOF);var bb=0;for(var cb in _)_[cb]>bb&&(bb=_[cb],O=cb);return"\r\n"!==O&&"\r"!==O&&"\n"!==O&&(O="\n"),U}function u(a){function b(){return a[cb+1]&&(cb+=1,db=a[cb]),cb}function c(b){return a[b]&&(cb=b,db=a[cb]),cb}function d(b,c){var d=c?c+cb:cb;return a[d]?a[d].isType(b):!1}function e(a){var b=a||0;return d(Q.NL,b)||d(Q.EOF,b)}function g(){return db instanceof r&&!d(Q.EOF)}function j(a){var b=d(Q.SPACES);return b&&l()&&(db.lexeme=db.substring(a-1,db.getLength())),b}function k(a){if(!g()||m())return!0;if(db.col<a&&!d(Q.SPACES)&&!e())return!0;var b=W[db.type],c=l()&&p();return b&&c}function l(){return e(-1)||d(Q.SPACES,-1)&&e(-2)}function m(){var a=0;return e(a)?e(a+1)?!0:d(Q.SPACES,a+1)&&e(a+2):!1}function n(a){return l()&&db.col===a?d(Q.DIV_LINE)||d(Q.ATX_END):!1}function p(){return e(1)||d(Q.SPACES,1)&&e(2)}function q(a,b){var c=b?b:db;return a?($[c.type]?a.push(0):_[c.type]&&a.pop(),a.length<=0):!1}function t(a){return d(Q.GT_THAN)&&X[a.type]}function u(a){return l()&&db.col===a.col&&p()?db.isSameType(a)&&db.lexeme===a.lexeme:!1}function v(a){return db!==a&&db.isSameType(a)?d(Q.CODE)&&db.lexeme==a.lexeme:!1}function w(){var a=0;return d(Q.SPACES,a)&&(a+=1),d(Q.NL,a)&&(a+=1),d(Q.SPACES,a)&&(a+=1),d(Q.LINK_CONT,a)}function x(b,c){for(var d="",e=b;c>e&&a[e]instanceof r;e+=1)d+=a[e].lexeme;return d}function y(a,c){for(var d=cb;g()&&!a[db.type];)b();return c?x(d,cb):void 0}function z(a,c){for(var d=cb;!e();)b();return c&&b(),a?x(d,cb):void 0}function A(){for(;d(Q.SPACES)||d(Q.NL);)b()}function B(){var a=db,b=new s(R.ASIDE);for(z(!1,!0),A();g()&&db.col>=a.col;){if(u(a)){z();break}b.addNode(E()),A()}return b}function D(){var a=db.lexeme.length,d=cb;b();var e=f(y(Y,!0));if(z(),0===e.length)return c(d),db.type=Q.TEXT,null;var g=new s(R.HEADER);return g.addText(e),g.meta.HEADERLVL=a,g}function E(){var a=null,b=eb<C.MAX_BLOCKS;if(A(),S[db.type]&&b)eb+=1,a=I(),eb-=1;else{if(d(Q.LABEL_ID)||d(Q.LABEL_CLASS))return H();if(d(Q.CODE)&&d(Q.NL,1))a=F();else if(d(Q.ASIDE_DELIM)&&b)eb+=1,a=B(),eb-=1;else if(d(Q.ATX))a=D();else if(d(Q.LINK_REF))a=J();else{if(d(Q.COMMENT_DELIM))return G(),a;d(Q.TR_DELIM)?(z(),a=new s(R.TR)):d(Q.LABEL_STOP)?(z(),a=new s(R.STOP)):d(Q.DIV_LINE)?(z(),a=new s(R.DIV_LINE)):d(Q.ATX_END)&&(db.type=Q.TEXT)}}return!a&&g()&&(A(),a=K()),a}function F(){var a=new s(R.CODE_BLOCK),c=db;z(!1,!0);for(var e=cb,f=cb;g()&&(j(c.col),!u(c));)f=b();return d(Q.SPACES,-1)&&(f-=1),a.addText(x(e,f)),e>=f&&a.addText(O),z(),a}function G(){for(var a=db;g();)if(z(),A(),u(a)){z();break}}function H(){var a=db.isType(Q.LABEL_ID);b();var c=i(z(!0,!1));return 0===c.length||a&&fb[c]?null:(a&&(fb[c]=c),new s(a?R.ID:R.CLASS,{ID:c}))}function I(){var a=new s(S[db.type]);if(b(),d(Q.SPACES)&&b(),e())return a;if(a.isType(R.DT))return a.addNodes(K()),a;for(var c=db.col;g()&&db.col>=c;)a.addNode(E()),A();return a}function J(){var a=cb,e="",f="";return b(),e=h(y(Z,!0)),d(Q.LINK_REF_END)?(b(),f=h(z(!0)),0===e.length||0===f.length?(c(a),K()):new s(R.LINK_REF,{REF_ID:e,URL:f})):(c(a),K())}function K(a,c,e,f){for(var g=c?c:[],h=a||db.col,i=new s(R.PARA),l=cb,m=cb,p=db,r=!1,t=null;!k(h)&&(j(h),r||!q(e,p));){if(U[p.type]){var u=o(g,p.type);if(u>=0){u===g.length-1&&(i.type=U[p.type]);break}var v=V[p.type],y=g.length>=C.MAX_SPANS;v&&!y&&(b(),g.push(v),t=K(h,g,e,f),g.pop(),t.err=t.isType(R.PARA))}else if(T[p.type])t=N(h,f);else if(p.isType(Q.CODE))t=M(h);else if(r&&p.isType(Q.LINK_CONT)){var z=L(h,i.getLast());z===i.getLast()?l=cb+1:t=z,r=!1}t instanceof s?(t.err?m+=1:k(h)||(b(),r=ab[t.type]&&w()),i.addText(x(l,m)),i.addNode(t),l=cb):b(),m=cb,p=db,t=null}return!c&&n(h)&&(i.type=R.HEADER,i.meta.HEADERLVL=d(Q.ATX_END)?1:2,b()),i.addText(x(l,m)),i}function L(a,c){if(!(c instanceof s&&ab[c.type]))return null;var d=null;if(c.isType(R.LINK_IMG)){if(d=P(a),d.err)return d;c.meta.ALT=d.meta.TEXT}else{var e=[0];if(b(),d=K(a,[],e,!0),0!==e.length)return d.err=!0,d;c.addNodes(d)}return c}function M(a){var b=P(a);if(b.err)return b;var c=new s(R.CODE);return c.addNode(b),c}function N(a,b){var c=db,d=c.isType(Q.LINK_IMG);if(b&&!d)return null;var e=P(a);return e.err||(e.type=T[c.type],e.meta.URL=h(e.meta.TEXT),e.err=0===e.meta.URL.length,e.err?(e.type=R.TEXT,delete e.meta.URL):(delete e.meta.TEXT,d&&(e.meta.ALT=""))),e}function P(a){var c=new s(R.TEXT),d=db,e=cb+1,f=$[d.type]?[0]:null;for(c.err=!0,b();!k(a);){if(j(a),q(f)||v(d)||t(d)){c.err=!1;break}b()}return c.meta.TEXT=x(e,cb),c}for(var bb=new s(R.ROOT),cb=0,db=a[cb],eb=0,fb={};g();)bb.addNode(E());return bb}function v(a){function b(a){for(var b=a.getLast();b&&b.isType(R.TR)&&0===b.getLength();)a.pop(),b=a.getLast();for(var c=a.getFirst().getLength(),d=0,e=a.getLength();e>d;d+=1){for(var f=a.children[d];f.getLength()>c;)f.pop();for(;f.getLength()<c&&f.getLength()>0;)f.addNode_simple(new s(R.TD));f.isDeleted=f.getLength()<=0}}function c(a){for(var b=a.getLast();b&&b.isType(R.DT);)a.pop(),b=a.getLast();for(var c=a.getFirst();c&&c.isType(R.DD);)a.popFirst(),c=a.getFirst();a.isDeleted=0===a.getLength()}function d(a){var b=0,c=0,f=null;for(b=0,c=a.getLength();c>b&&(f=a.children[b],!f.isType(R.TEXT)||M.test(f.meta.TEXT))&&(!(f.getLength()>0||ab[f.type])||(d(f),f.isDeleted));b+=1);if(a.isDeleted=b>=c&&!ab[a.type],!a.isDeleted&&(ab[a.type]&&1===a.getLength()&&(f=a.getLast(),f.isType(R.TEXT)&&M.test(f.meta.TEXT)&&a.pop()),C.RM_EOL))for(b=0,c=a.getLength();c>b;b+=1)f=a.children[b],f.isType(Q.TEXT)&&(f.meta.TEXT=e(f.meta.TEXT))}function f(a){for(var e=0,i=a.getLength();i>e;e+=1){var j=a.children[e];if(j.isType(R.TABLE)&&b(j),j.isType(R.DL)&&c(j),j.isType(R.TEXT)||bb[j.type]||ab[j.type]){if(d(a),!a.isDeleted){var k=a.getLast();k.isType(R.TEXT)&&(k.meta.TEXT=g(k.meta.TEXT))}return}j.getLength()>0&&!j.isType(R.CODE_BLOCK)&&f(j),j.isDeleted=cb[j.type]&&j.getLength()<=0}h(a)}function h(a){var b=a.getLength()-1;for(b;b>=0;b-=1){var c=a.children[b];if(!c.isDeleted&&!db[c.type])break;a.pop()}a.isDeleted=0>b&&!ab[a.type]}function i(a){return a.isDeleted?!1:(a.children=p(a.children,i),(cb[a.type]||bb[a.type])&&(a.isDeleted=a.getLength()<=0),!a.isDeleted)}return f(a),a.children=p(a.children,i),a}function w(a){return v(u(t(a)))}function x(c){function d(a,b){if(!eb[a.type])return"";var c=eb[a.type],d="<"+c;if(a.isType(R.HEADER)&&a.meta.HEADERLVL){var e=a.meta.HEADERLVL+D.MIN_HEADER;d+=e>6?"6":e+""}if(b)for(var f in b)b[f]=b[f].substring(0,D.MAX_ATTR_CHARS),d+=" "+f+'="'+l(b[f])+'"';return fb[a.type]&&D.XHTML&&(d+="/"),d+=">",a.isType(R.CODE_BLOCK)&&(d+="<code>"),d}function e(a){if(!eb[a.type])return"";var b=eb[a.type];if(a.isType(R.HEADER)&&a.meta.HEADERLVL){var c=a.meta.HEADERLVL+D.MIN_HEADER;b+=c>6?"6":c+""}return a.isType(R.CODE_BLOCK)?"</code></"+b+">":"</"+b+">"}function f(a){return a instanceof s&&a.meta.TEXT?D.XHTML?j(a.meta.TEXT):k(a.meta.TEXT):""}function g(a){for(var c=a.meta.URL,f=a.isType(R.LINK_IMG),g=a.meta.ALT,j=a.parent,l=!1;j;){if(ab[j.type]&&(l=!0),j.meta.SYM_TABLE&&j.meta.SYM_TABLE[c]){c=j.meta.SYM_TABLE[c];break}j=j.parent}a.isType(R.LINK_INT)&&(c="#"+b(c)),f&&M.test(g)&&l&&(g=c);var m=f?{src:c,alt:g}:{href:c};return f?d(a,m):(a.isType(R.LINK_WIKI)&&(m["class"]=i(D.CSS_WIKI)),a.getLength()>0?d(a,m)+h(a,m)+e(a):d(a,m)+k(a.meta.URL)+e(a))}function h(a){var b=a.getLength(),c=0,i="";for(c=0;b>c;c+=1){var j=a.children[c];i+=ab[j.type]?g(j):bb[j.type]?d(j)+h(j)+e(j):f(j)}return i}function m(a,b,c){return n(P,c)+d(a,b)+O}function o(c,f,g,i){var j=c.getLength(),k=0,l=null,p="",q=null,r=null,s=null,t="",u=d(c,f),v=e(c,f),w=n(P,g);for(k=0;j>k;k+=1)if(l=c.children[k],l.isType(R.ID))s=b(l.meta.ID,!0);else if(l.isType(R.CLASS))q=q?q:[],q.push(l.meta.ID);else{if((s||q)&&(r={},s&&(r.id=s),q&&(r["class"]=a(q,!0))),s=null,q=null,l.isType(R.DIV_LINE))p+=m(l,f,g);else{if(l.isType(R.TEXT)||bb[l.type]||ab[l.type]){p+=h(c);break}p+=o(l,r,g+1,k===j-1)}r=null}if(c.isType(R.CODE_BLOCK))t=u+p+v;else{if(c.isType(R.ROOT))return p;t=w+u+O+p+O+w+v}return i||(t+=O),t}return o(c,null,-1,!1)}function y(a,b){C=q(A,a),D=q(B,b)}function z(a){return x(w(a))}var A={RM_EOL:0,MAX_BLOCKS:8,MAX_SPANS:10,ALLOW_IMG:1,ALLOW_LINK:1,ALLOW_CLASS:1,ALLOW_ID:1},B={MAX_ATTR_CHARS:2048,CSS_PRE_ID:"bbm-",CSS_PRE:"bbm-",CSS_WIKI:"w-bbm",MIN_HEADER:0,XHTML:0},C=A,D=B,E="[ \\u2000-\\u200d\\t\\u202f\\u205f\\u3000\\u1680\\u180e\\u00a0\\u00b7\\u237d\\u2420\\u2422\\u2423]+",F="[\\v\\f\\r\\n\\u0085\\u2028\\u2029]+",G="[\\u0000-\\u001f\\u007f-\\u009f\\u2028\\u2029]+",H=new RegExp(E),I=new RegExp(E,"g"),J=new RegExp(F),K=new RegExp(F,"g"),L=new RegExp(G,"g"),M=/^\s*$/,N=/[0-9]+/,O="\n",P=" ",Q={SPACES:"SPACES",NL:"NL",TEXT:"TEXT",UNDER:"UNDER",SUB:"SUB",SUP:"SUP",CODE:"CODE",ITAL:"ITAL",BOLD:"BOLD",INS:"INS",INS_END:"INS_END",DEL:"DEL",DEL_END:"DEL_END",DIV_LINE:"DIV_LINE",COMMENT_DELIM:"COMMENT_DELIM",ASIDE_DELIM:"ASIDE_DELIM",TH:"TH",TD:"TD",TR_DELIM:"TR_DELIM",ATX:"ATX",ATX_END:"ATX_END",OL_ITEM:"OL_ITEM",UL_ITEM:"UL_ITEM",DT_MARK:"DT_MARK",DD_MARK:"DD_MARK",LABEL_CLASS:"LABEL_CLASS",LABEL_ID:"LABEL_ID",LABEL_STOP:"LABEL_STOP",LINK_REF_END:"LINK_REF_END",LINK_REF:"LINK_REF",LINK_CONT:"LINK_CONT",LINK_INT:"LINK_INT",LINK_WIKI:"LINK_WIKI",LINK_EXT:"LINK_EXT",LINK_IMG:"LINK_IMG",GT_THAN:"GT_THAN",BRACKET_L:"BRACKET_L",BRACKET_R:"BRACKET_R",EOF:"EOF"},R={ROOT:"ROOT",PARA:"PARA",STOP:"STOP",BLOCKQUOTE:"BLOCKQUOTE",CODE_BLOCK:"CODE_BLOCK",ASIDE:"ASIDE",ID:"ID",CLASS:"CLASS",UL:"UL",OL:"OL",UL_LI:"UL_LI",OL_LI:"OL_LI",HEADER:"HEADER",DIV_LINE:"DIV_LINE",DT:"DT",DD:"DD",DL:"DL",TH:"TH",TD:"TD",TR:"TR",TABLE:"TABLE",LINK_REF:"LINK_REF",LINK_INT:"LINK_INT",LINK_EXT:"LINK_EXT",LINK_IMG:"LINK_IMG",LINK_WIKI:"LINK_WIKI",TEXT:"TEXT",DEL:"DEL",INS:"INS",UNDER:"UNDER",SUB:"SUB",SUP:"SUP",ITAL:"ITAL",BOLD:"BOLD",CODE:"CODE"},S={GT_THAN:R.BLOCKQUOTE,UL_ITEM:R.UL_LI,OL_ITEM:R.OL_LI,DT_MARK:R.DT,DD_MARK:R.DD,TH:R.TH,TD:R.TD},T={LINK_INT:R.LINK_INT,LINK_EXT:R.LINK_EXT,LINK_IMG:R.LINK_IMG,LINK_WIKI:R.LINK_WIKI},U={INS:R.INS,DEL:R.DEL,INS_END:R.INS,DEL_END:R.DEL,BOLD:R.BOLD,ITAL:R.ITAL,SUP:R.SUP,SUB:R.SUB,UNDER:R.UNDER},V={INS:Q.INS_END,DEL:Q.DEL_END,BOLD:Q.BOLD,ITAL:Q.ITAL,SUP:Q.SUP,SUB:Q.SUB,UNDER:Q.UNDER},W={ASIDE_DELIM:1,ATX_END:1,DIV_LINE:1},X={LINK_EXT:1,LINK_IMG:1,LINK_WIKI:1},Y={ATX_END:1,NL:1},Z={LINK_REF_END:1,NL:1},$={BRACKET_L:1,LINK_INT:1,LINK_CONT:1},_={BRACKET_R:1},ab={LINK_IMG:1,LINK_EXT:1,LINK_INT:1,LINK_WIKI:1},bb={SUB:1,SUP:1,ITAL:1,BOLD:1,DEL:1,INS:1,UNDER:1,CODE:1},cb={STOP:1,PARA:1,BLOCKQUOTE:1,ASIDE:1,UL_LI:1,OL_LI:1,HEADER:1,OL:1,UL:1,DL:1,DD:1,DT:1,TR:1},db={ID:1,CLASS:1,STOP:1},eb={PARA:"p",BLOCKQUOTE:"blockquote",CODE_BLOCK:"pre",ASIDE:"div",UL_LI:"li",OL_LI:"li",OL:"ol",UL:"ul",DL:"dl",DD:"dd",DT:"dt",DIV_LINE:"hr",TH:"th",TD:"td",TR:"tr",TABLE:"table",LINK_INT:"a",LINK_EXT:"a",LINK_WIKI:"a",LINK_IMG:"img",SUB:"sub",SUP:"sup",ITAL:"em",BOLD:"strong",DEL:"del",INS:"ins",UNDER:"u",CODE:"code",HEADER:"h"},fb={LINK_IMG:1,DIV_LINE:1};return r.prototype={isType:function(a){return this.type===a},isSameType:function(a){return this.type===a.type},substring:function(a,b){return this.lexeme.substring(a,b)},getLength:function(){return this.lexeme.length}},s.prototype={getLast:function(){return this.children[this.children.length-1]},getFirst:function(){return this.children[0]},getLength:function(){return this.children.length},isType:function(a){return this.type===a},isSameType:function(a){return this.type===a.type},pop:function(){this.children.pop()},popFirst:function(){this.children.shift()},addNode_simple:function(a){var b=this.getLast();return b&&b.isType(R.TEXT)&&b.isSameType(a)?void(b.meta.TEXT+=a.meta.TEXT):(a.parent=this,void this.children.push(a))},addNode_table:function(a){var b=this.getLast();if(!b||!b.isType(R.TABLE)){if(a.isType(R.TR))return;b=new s(R.TABLE),this.addNode_simple(b)}b.getLength()<=0&&b.addNode_simple(new s(R.TR));var c=b.getLast();a.isType(R.TH)||a.isType(R.TD)?c.addNode_simple(a):a.isType(R.TR)&&c.getLength()>0&&b.addNode_simple(a)},addNode_ul_ol:function(a){var b=a.isType(R.UL_LI)?R.UL:R.OL,c=this.getLast();c&&c.isType(b)||(c=new s(b),this.addNode_simple(c)),c.addNode_simple(a)},addNode_dl:function(a){var b=this.getLast();b&&b.isType(R.DL)||(b=new s(R.DL),this.addNode_simple(b)),b.addNode_simple(a)},addNode:function(a){a instanceof s&&a!==this&&(a.isType(R.LINK_REF)?(this.meta.SYM_TABLE||(this.meta.SYM_TABLE={}),this.meta.SYM_TABLE[a.meta.REF_ID]=a.meta.URL):this.isType(R.PARA)&&this.isSameType(a)?this.addNodes(a):a.isType(R.UL_LI)||a.isType(R.OL_LI)?this.addNode_ul_ol(a):a.isType(R.TR)||a.isType(R.TH)||a.isType(R.TD)?this.addNode_table(a):a.isType(R.DD)||a.isType(R.DT)?this.addNode_dl(a):this.addNode_simple(a))},addText:function(a){a&&a.length>0&&this.addNode_simple(new s(R.TEXT,{TEXT:a}))},addNodes:function(a){if(a instanceof s&&a!==this)for(var b=0,c=a.children.length;c>b;b+=1)this.addNode_simple(a.children[b])}},{lexer:t,parser:u,filter:v,frontEnd:w,compileStr:z,setOptions:y,AST_ENUM:R,LEX_ENUM:Q,ASTNode:function(a,b){return new s(a,b)},LexToken:function(a,b,c){return new r(a,b,c)}}}();"undefined"!=typeof module&&(module.exports=BBMCompiler);